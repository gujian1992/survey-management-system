# é€»è¾‘åˆ é™¤åŠŸèƒ½ä¿®å¤è¯´æ˜

## ğŸ” é—®é¢˜åˆ†æ

### é—®é¢˜ç°è±¡
é¢˜åº“åˆ é™¤åŠŸèƒ½ä¸èµ·ä½œç”¨ï¼š
- å•ä¸ªåˆ é™¤æ— æ•ˆ
- æ‰¹é‡åˆ é™¤æ— æ•ˆ
- è¢«"åˆ é™¤"çš„é¢˜ç›®ä»åœ¨åˆ—è¡¨ä¸­æ˜¾ç¤º

### æ ¹æœ¬åŸå› 
Serviceå±‚çš„åˆ é™¤æ–¹æ³•å®ç°é”™è¯¯ï¼š
```java
// âŒ é”™è¯¯çš„å®ç°
public boolean deleteQuestion(Long id) {
    QuestionBank question = getById(id);
    if (question == null || question.getDeleted() == 1) {
        throw new BusinessException(ErrorCode.QUESTION_NOT_FOUND);
    }
    
    question.setDeleted(1);           // æ‰‹åŠ¨è®¾ç½®åˆ é™¤æ ‡è®°
    question.setUpdateTime(LocalDateTime.now());
    
    return updateById(question);      // è°ƒç”¨updateè€Œä¸æ˜¯delete
}
```

**é—®é¢˜**ï¼š
1. ä½¿ç”¨`updateById`æ–¹æ³•è€Œä¸æ˜¯MyBatis Plusçš„é€»è¾‘åˆ é™¤
2. æ‰‹åŠ¨è®¾ç½®`deleted = 1`ï¼Œç»•è¿‡äº†MyBatis Plusçš„é€»è¾‘åˆ é™¤æœºåˆ¶
3. MyBatis Plusæ— æ³•è¯†åˆ«è¿™æ˜¯åˆ é™¤æ“ä½œï¼Œä¸ä¼šè§¦å‘é€»è¾‘åˆ é™¤çš„ç›¸å…³å¤„ç†

---

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### 1. ä¿®å¤åˆ é™¤æ–¹æ³•
**æ­£ç¡®çš„å®ç°**ï¼š
```java
// âœ… æ­£ç¡®çš„å®ç°
@Override
@Transactional
public boolean deleteQuestion(Long id) {
    QuestionBank question = getById(id);
    if (question == null) {
        throw new BusinessException(ErrorCode.QUESTION_NOT_FOUND);
    }
    
    // ä½¿ç”¨MyBatis Plusçš„é€»è¾‘åˆ é™¤åŠŸèƒ½
    return removeById(id);
}

@Override
@Transactional
public boolean batchDeleteQuestions(List<Long> ids) {
    if (ids == null || ids.isEmpty()) {
        throw new BusinessException(ErrorCode.PARAMETER_INVALID, "è¯·é€‰æ‹©è¦åˆ é™¤çš„é¢˜ç›®");
    }
    
    // ä½¿ç”¨MyBatis Plusçš„æ‰¹é‡é€»è¾‘åˆ é™¤åŠŸèƒ½
    return removeByIds(ids);
}
```

### 2. MyBatis Plusé€»è¾‘åˆ é™¤æœºåˆ¶
**é…ç½®ï¼ˆå·²æ­£ç¡®ï¼‰**ï¼š
```yaml
# application.yml
mybatis-plus:
    global-config:
        db-config:
            logic-delete-field: deleted      # é€»è¾‘åˆ é™¤å­—æ®µå
            logic-delete-value: 1            # åˆ é™¤åçš„å€¼
            logic-not-delete-value: 0        # æ­£å¸¸çŠ¶æ€çš„å€¼
```

**å®ä½“ç±»é…ç½®ï¼ˆå·²æ­£ç¡®ï¼‰**ï¼š
```java
@TableLogic
@Schema(description = "é€»è¾‘åˆ é™¤ï¼š0-æœªåˆ é™¤ 1-å·²åˆ é™¤")
private Integer deleted = 0;
```

---

## ğŸ”„ MyBatis Plusé€»è¾‘åˆ é™¤å·¥ä½œåŸç†

### 1. åˆ é™¤æ“ä½œè½¬æ¢
```java
// ä»£ç è°ƒç”¨
removeById(1L);

// å®é™…æ‰§è¡Œçš„SQL
UPDATE question_bank SET deleted = 1 WHERE id = 1 AND deleted = 0;
```

### 2. æŸ¥è¯¢æ“ä½œè‡ªåŠ¨è¿‡æ»¤
```java
// ä»£ç è°ƒç”¨
getById(1L);

// å®é™…æ‰§è¡Œçš„SQL  
SELECT * FROM question_bank WHERE id = 1 AND deleted = 0;
```

### 3. è‡ªå®šä¹‰æŸ¥è¯¢éœ€è¦æ‰‹åŠ¨å¤„ç†
```java
// Mapperä¸­çš„è‡ªå®šä¹‰æŸ¥è¯¢éœ€è¦æ‰‹åŠ¨æ·»åŠ deletedæ¡ä»¶
@Select("SELECT qb.*, u.real_name as creator_name " +
        "FROM question_bank qb " +
        "LEFT JOIN sys_user u ON qb.creator_id = u.id " +
        "WHERE qb.deleted = 0 " +  // âœ… æ‰‹åŠ¨æ·»åŠ é€»è¾‘åˆ é™¤æ¡ä»¶
        "AND (#{type} IS NULL OR qb.type = #{type}) " +
        "ORDER BY qb.create_time DESC")
IPage<QuestionBank> selectQuestionPage(/*...*/);
```

---

## ğŸ“Š ä¿®å¤èŒƒå›´

### æ¶‰åŠçš„æ–‡ä»¶
1. âœ… **QuestionBankServiceImpl.java** - ä¿®å¤`deleteQuestion`å’Œ`batchDeleteQuestions`æ–¹æ³•
2. âœ… **QuestionBankMapper.java** - è‡ªå®šä¹‰æŸ¥è¯¢å·²æ­£ç¡®æ·»åŠ `deleted = 0`æ¡ä»¶
3. âœ… **QuestionBank.java** - å®ä½“ç±»å·²æ­£ç¡®é…ç½®`@TableLogic`æ³¨è§£
4. âœ… **application.yml** - MyBatis Plusé€»è¾‘åˆ é™¤é…ç½®å·²æ­£ç¡®

### ä¿®å¤çš„æ–¹æ³•
| æ–¹æ³• | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| `deleteQuestion` | æ‰‹åŠ¨è®¾ç½®`deleted=1`+`updateById` | ä½¿ç”¨`removeById` |
| `batchDeleteQuestions` | å¾ªç¯è°ƒç”¨`deleteQuestion` | ä½¿ç”¨`removeByIds` |
| `getById`ç­‰åŸºç¡€æ–¹æ³• | è‡ªåŠ¨ç”Ÿæ•ˆ | è‡ªåŠ¨ç”Ÿæ•ˆ |
| è‡ªå®šä¹‰æŸ¥è¯¢æ–¹æ³• | æ‰‹åŠ¨æ·»åŠ æ¡ä»¶ï¼ˆå·²æ­£ç¡®ï¼‰ | æ‰‹åŠ¨æ·»åŠ æ¡ä»¶ï¼ˆå·²æ­£ç¡®ï¼‰ |

---

## ğŸš€ åŠŸèƒ½éªŒè¯

### âœ… åˆ é™¤åŠŸèƒ½æµ‹è¯•
1. **å•ä¸ªåˆ é™¤**ï¼š
   ```bash
   DELETE /api/question-bank/5
   ```
   - è°ƒç”¨`removeById(5)`
   - æ‰§è¡ŒSQLï¼š`UPDATE question_bank SET deleted = 1 WHERE id = 5 AND deleted = 0`
   - åˆ—è¡¨ä¸­ä¸å†æ˜¾ç¤ºè¯¥é¢˜ç›®

2. **æ‰¹é‡åˆ é™¤**ï¼š
   ```bash
   DELETE /api/question-bank/batch
   Body: [1, 2, 3]
   ```
   - è°ƒç”¨`removeByIds([1, 2, 3])`
   - æ‰§è¡ŒSQLï¼š`UPDATE question_bank SET deleted = 1 WHERE id IN (1, 2, 3) AND deleted = 0`
   - åˆ—è¡¨ä¸­ä¸å†æ˜¾ç¤ºè¿™äº›é¢˜ç›®

3. **æŸ¥è¯¢è¿‡æ»¤**ï¼š
   ```bash
   GET /api/question-bank/page
   ```
   - åªè¿”å›`deleted = 0`çš„é¢˜ç›®
   - å·²åˆ é™¤çš„é¢˜ç›®è‡ªåŠ¨è¢«è¿‡æ»¤

---

## ğŸ¯ æŠ€æœ¯è¦ç‚¹

### 1. MyBatis Plusæ–¹æ³•å¯¹æ¯”
```java
// é€»è¾‘åˆ é™¤ï¼ˆæ¨èï¼‰
removeById(id);           // è®¾ç½®deleted=1
removeByIds(ids);         // æ‰¹é‡è®¾ç½®deleted=1

// ç‰©ç†åˆ é™¤ï¼ˆæ…ç”¨ï¼‰
getBaseMapper().deleteById(id);     // çœŸæ­£åˆ é™¤è®°å½•
getBaseMapper().deleteByIds(ids);   // æ‰¹é‡åˆ é™¤è®°å½•
```

### 2. æŸ¥è¯¢æ–¹æ³•è‡ªåŠ¨è¿‡æ»¤
```java
// è¿™äº›æ–¹æ³•è‡ªåŠ¨æ·»åŠ  deleted = 0 æ¡ä»¶
getById(id);              // å•ä¸ªæŸ¥è¯¢
list();                   // åˆ—è¡¨æŸ¥è¯¢  
page(page);               // åˆ†é¡µæŸ¥è¯¢
count();                  // è®¡æ•°æŸ¥è¯¢
```

### 3. è‡ªå®šä¹‰æŸ¥è¯¢å¤„ç†
```java
// éœ€è¦æ‰‹åŠ¨æ·»åŠ é€»è¾‘åˆ é™¤æ¡ä»¶
@Select("SELECT * FROM question_bank WHERE deleted = 0 AND status = 1")
List<QuestionBank> selectActiveQuestions();
```

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. ç»Ÿä¸€ä½¿ç”¨MyBatis Plusæ–¹æ³•
```java
// âœ… æ¨è
return removeById(id);

// âŒ é¿å…
question.setDeleted(1);
return updateById(question);
```

### 2. è‡ªå®šä¹‰æŸ¥è¯¢æ·»åŠ é€»è¾‘åˆ é™¤æ¡ä»¶
```java
// âœ… æ¨è
@Select("SELECT * FROM question_bank WHERE deleted = 0 AND type = #{type}")
List<QuestionBank> selectByType(@Param("type") Integer type);

// âŒ é”™è¯¯
@Select("SELECT * FROM question_bank WHERE type = #{type}")  // ç¼ºå°‘deletedæ¡ä»¶
List<QuestionBank> selectByType(@Param("type") Integer type);
```

### 3. å¼‚å¸¸å¤„ç†ä¼˜åŒ–
```java
// ä¿®å¤åï¼šgetByIdè‡ªåŠ¨è¿‡æ»¤å·²åˆ é™¤è®°å½•
QuestionBank question = getById(id);
if (question == null) {  // ä¸å­˜åœ¨æˆ–å·²åˆ é™¤
    throw new BusinessException(ErrorCode.QUESTION_NOT_FOUND);
}
```

---

## ğŸ” éªŒè¯SQL

### 1. åˆ é™¤æ“ä½œç”Ÿæˆçš„SQL
```sql
-- removeById(5)
UPDATE question_bank SET deleted = 1 WHERE id = 5 AND deleted = 0;

-- removeByIds([1,2,3])  
UPDATE question_bank SET deleted = 1 WHERE id IN (1, 2, 3) AND deleted = 0;
```

### 2. æŸ¥è¯¢æ“ä½œç”Ÿæˆçš„SQL
```sql
-- getById(5)
SELECT * FROM question_bank WHERE id = 5 AND deleted = 0;

-- list()
SELECT * FROM question_bank WHERE deleted = 0;
```

---

**âœ… é€»è¾‘åˆ é™¤åŠŸèƒ½ä¿®å¤å®Œæˆï¼ç°åœ¨åˆ é™¤æ“ä½œä¼šæ­£ç¡®è®¾ç½®deletedå­—æ®µï¼Œè¢«åˆ é™¤çš„é¢˜ç›®ä¸ä¼šåœ¨åˆ—è¡¨ä¸­æ˜¾ç¤ºã€‚** 